# JIRA 9.11.2 Plugin Upgrade Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Upgrade the Planning Poker plugin from JIRA 6.4 to JIRA 9.11.2 compatibility

**Architecture:** This is a major version migration spanning JIRA 6.4 → 7.x → 8.x → 9.11.2. We'll update Maven dependencies, replace deprecated APIs (User → ApplicationUser), upgrade to Java 17, update AMPS to 9.x, modernize JavaScript modules, update Velocity templates, and verify compatibility through Docker-based testing.

**Tech Stack:**
- Java 17 (upgrade from Java 6)
- AMPS 9.0.2+ (upgrade from 5.0.13)
- JIRA API 9.11.2 (upgrade from 6.4)
- Maven 3.x
- Docker (for testing)
- Velocity templates (maintain existing)

---

## Task 1: Analyze Current Codebase Dependencies

**Files:**
- Read: `pom.xml`
- Read: `src/main/resources/atlassian-plugin.xml`
- Analyze: All Java files in `src/main/java/com/redhat/engineering/plugins/`

**Step 1: Document current dependencies and API usage**

Create analysis document:

```bash
cat > docs/dependency-analysis.md << 'EOF'
# Current Dependency Analysis

## Maven Dependencies
- JIRA API: 6.4
- AMPS: 5.0.13
- Java: 1.6
- Guava: 14.0.1
- GSON: 2.2.2-atlassian-1

## API Usage Patterns to Review
- [ ] com.atlassian.crowd.embedded.api.User usage
- [ ] Webwork1 actions
- [ ] Velocity templates
- [ ] JavaScript globals
- [ ] REST API endpoints

## Breaking Changes to Address
1. User → ApplicationUser migration
2. Webwork1 deprecation status
3. Java 6 → Java 17 compatibility
4. AMPS 5.x → 9.x migration
5. Spring 2 → Spring 3+
EOF
```

**Step 2: Grep for deprecated User class usage**

Run:
```bash
grep -r "com.atlassian.crowd.embedded.api.User" src/main/java/ || echo "No User class found"
grep -r "import.*User" src/main/java/ | grep -v "UserNotFoundException"
```

Expected: List of files using deprecated User class

**Step 3: Grep for webwork1 usage**

Run:
```bash
grep -r "webwork" src/main/resources/atlassian-plugin.xml
grep -r "webwork" src/main/java/
```

Expected: List of webwork1 action references

**Step 4: Document findings**

Append analysis results to `docs/dependency-analysis.md` with specific line numbers and files requiring updates.

**Step 5: Commit**

```bash
git add docs/dependency-analysis.md
git commit -m "docs: analyze current JIRA 6.4 dependencies and deprecated API usage"
```

---

## Task 2: Set Up Docker Build Environment

**Files:**
- Create: `Dockerfile`
- Create: `docker-compose.yml`
- Create: `.dockerignore`

**Step 1: Write Dockerfile for Maven build environment**

```dockerfile
FROM maven:3.9-eclipse-temurin-17

# Install Atlassian SDK
RUN apt-get update && apt-get install -y wget unzip && \
    wget https://marketplace.atlassian.com/download/apps/1210993/version/42020 -O atlassian-plugin-sdk.tar.gz && \
    mkdir -p /opt/atlassian-plugin-sdk && \
    tar -xzf atlassian-plugin-sdk.tar.gz -C /opt/atlassian-plugin-sdk --strip-components=1 && \
    rm atlassian-plugin-sdk.tar.gz

ENV PATH="/opt/atlassian-plugin-sdk/bin:${PATH}"
ENV ATLAS_MVN="/opt/atlassian-plugin-sdk/apache-maven/bin/mvn"

WORKDIR /workspace

# Copy project files
COPY pom.xml .
COPY src ./src

CMD ["bash"]
```

**Step 2: Write docker-compose for development environment**

```yaml
version: '3.8'

services:
  build:
    build: .
    volumes:
      - .:/workspace
      - maven-cache:/root/.m2
    environment:
      - MAVEN_OPTS=-Xmx2048m
    command: tail -f /dev/null

  jira:
    image: atlassian/jira-software:9.11.2
    ports:
      - "2990:8080"
    environment:
      - ATL_JDBC_URL=jdbc:h2:mem:jira
      - ATL_JDBC_DRIVER=org.h2.Driver
      - ATL_DB_TYPE=h2
      - JVM_MINIMUM_MEMORY=2048m
      - JVM_MAXIMUM_MEMORY=4096m
    volumes:
      - jira-data:/var/atlassian/application-data/jira

volumes:
  maven-cache:
  jira-data:
```

**Step 3: Write .dockerignore**

```
target/
.git/
.idea/
*.iml
.DS_Store
docs/
```

**Step 4: Test Docker build**

Run:
```bash
docker-compose build build
```

Expected: Successful build with no errors

**Step 5: Commit**

```bash
git add Dockerfile docker-compose.yml .dockerignore
git commit -m "build: add Docker environment for JIRA 9.11.2 development"
```

---

## Task 3: Update POM Dependencies for JIRA 9.11.2

**Files:**
- Modify: `pom.xml:115-121`

**Step 1: Update Java version and AMPS version**

Replace in `pom.xml`:

```xml
<properties>
    <jira.version>6.4</jira.version>
    <amps.version>5.0.13</amps.version>
    <plugin.testrunner.version>1.2.0</plugin.testrunner.version>
    <testkit.version>5.2.26</testkit.version>
</properties>
```

With:

```xml
<properties>
    <jira.version>9.11.2</jira.version>
    <amps.version>9.0.2</amps.version>
    <plugin.testrunner.version>2.0.3</plugin.testrunner.version>
    <testkit.version>9.1.0</testkit.version>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
</properties>
```

**Step 2: Update Java compiler version**

Replace in `pom.xml`:

```xml
<plugin>
    <artifactId>maven-compiler-plugin</artifactId>
    <configuration>
        <source>1.6</source>
        <target>1.6</target>
    </configuration>
</plugin>
```

With:

```xml
<plugin>
    <artifactId>maven-compiler-plugin</artifactId>
    <version>3.11.0</version>
    <configuration>
        <source>17</source>
        <target>17</target>
        <release>17</release>
    </configuration>
</plugin>
```

**Step 3: Update Guava and GSON versions**

Replace in `pom.xml`:

```xml
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>14.0.1</version>
</dependency>
<dependency>
    <groupId>com.google.code.gson</groupId>
    <artifactId>gson</artifactId>
    <version>2.2.2-atlassian-1</version>
</dependency>
```

With:

```xml
<dependency>
    <groupId>com.google.guava</groupId>
    <artifactId>guava</artifactId>
    <version>31.1-jre</version>
    <scope>provided</scope>
</dependency>
<dependency>
    <groupId>com.google.code.gson</groupId>
    <artifactId>gson</artifactId>
    <version>2.10.1</version>
    <scope>provided</scope>
</dependency>
```

**Step 4: Update JUnit version**

Replace in `pom.xml`:

```xml
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.10</version>
    <scope>test</scope>
</dependency>
```

With:

```xml
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.13.2</version>
    <scope>test</scope>
</dependency>
```

**Step 5: Test dependency resolution**

Run in Docker:
```bash
docker-compose run --rm build mvn dependency:resolve
```

Expected: All dependencies resolve successfully

**Step 6: Commit**

```bash
git add pom.xml
git commit -m "build: upgrade to JIRA 9.11.2, AMPS 9.0.2, and Java 17"
```

---

## Task 4: Search and Document User API Usage

**Files:**
- Analyze: All Java service and action classes

**Step 1: Search for User class imports**

Run:
```bash
find src/main/java -name "*.java" -exec grep -l "com.atlassian.crowd.embedded.api.User" {} \; > /tmp/user-api-files.txt
cat /tmp/user-api-files.txt
```

Expected: List of files using deprecated User API

**Step 2: Search for User class method parameters**

Run:
```bash
grep -n "User user" src/main/java/com/redhat/engineering/plugins/**/*.java || echo "No User parameters found"
```

**Step 3: Search for User class return types**

Run:
```bash
grep -n "public User" src/main/java/com/redhat/engineering/plugins/**/*.java || echo "No User return types found"
```

**Step 4: Document User API migration plan**

Create:
```bash
cat > docs/user-api-migration.md << 'EOF'
# User → ApplicationUser Migration Plan

## Files Requiring Updates
[List files from search results]

## Migration Pattern

### Before (JIRA 6.4):
```java
import com.atlassian.crowd.embedded.api.User;

public User getCurrentUser() {
    return ComponentAccessor.getJiraAuthenticationContext().getUser();
}
```

### After (JIRA 9.11.2):
```java
import com.atlassian.jira.user.ApplicationUser;

public ApplicationUser getCurrentUser() {
    return ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser();
}
```

## API Changes
- `User.getName()` → `ApplicationUser.getUsername()`
- `User.getDisplayName()` → `ApplicationUser.getDisplayName()` (unchanged)
- `User.getEmailAddress()` → `ApplicationUser.getEmailAddress()` (unchanged)
- `getUser()` → `getLoggedInUser()`
EOF
```

**Step 5: Commit**

```bash
git add docs/user-api-migration.md
git commit -m "docs: document User to ApplicationUser migration strategy"
```

---

## Task 5: Migrate User API in Service Classes

**Files:**
- Modify: `src/main/java/com/redhat/engineering/plugins/services/SessionService.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/services/VoteService.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/services/GroupService.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/services/ConfigService.java`

**Step 1: Read SessionService to understand User usage**

Run:
```bash
grep -n "User" src/main/java/com/redhat/engineering/plugins/services/SessionService.java
```

Expected: List of User class usages with line numbers

**Step 2: Update SessionService imports**

In `SessionService.java`, replace:
```java
import com.atlassian.crowd.embedded.api.User;
```

With:
```java
import com.atlassian.jira.user.ApplicationUser;
```

**Step 3: Update SessionService method signatures**

Replace all occurrences of `User` parameter types with `ApplicationUser` in method signatures.

Pattern:
- `public Session createSession(..., User creator, ...)` → `public Session createSession(..., ApplicationUser creator, ...)`
- `User user` → `ApplicationUser user`

**Step 4: Update User method calls**

Replace:
- `user.getName()` → `user.getUsername()`
- Keep `user.getDisplayName()` and `user.getEmailAddress()` unchanged

**Step 5: Repeat for VoteService**

Apply same migration pattern to `VoteService.java`

**Step 6: Repeat for GroupService**

Apply same migration pattern to `GroupService.java`

**Step 7: Repeat for ConfigService**

Apply same migration pattern to `ConfigService.java`

**Step 8: Compile to verify changes**

Run:
```bash
docker-compose run --rm build mvn clean compile
```

Expected: Compilation succeeds with no User API errors

**Step 9: Commit**

```bash
git add src/main/java/com/redhat/engineering/plugins/services/
git commit -m "refactor: migrate User to ApplicationUser in service classes"
```

---

## Task 6: Migrate User API in Action Classes

**Files:**
- Modify: `src/main/java/com/redhat/engineering/plugins/actions/SessionAction.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/actions/VoteAction.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/actions/ConfigAction.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/actions/PokerGroupPickerAction.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/actions/ShowPokerSessionsAction.java`

**Step 1: Read SessionAction to understand User usage**

Run:
```bash
grep -n "User\|getUser\|getLoggedInUser" src/main/java/com/redhat/engineering/plugins/actions/SessionAction.java
```

Expected: User API usage patterns

**Step 2: Update SessionAction imports**

Replace:
```java
import com.atlassian.crowd.embedded.api.User;
```

With:
```java
import com.atlassian.jira.user.ApplicationUser;
```

**Step 3: Update getCurrentUser calls in SessionAction**

Replace:
```java
User user = getLoggedInUser();
// or
User user = ComponentAccessor.getJiraAuthenticationContext().getUser();
```

With:
```java
ApplicationUser user = getLoggedInUser();
// or
ApplicationUser user = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser();
```

**Step 4: Update User method calls**

Replace `.getName()` with `.getUsername()` throughout the file.

**Step 5: Repeat steps 1-4 for VoteAction**

**Step 6: Repeat steps 1-4 for ConfigAction**

**Step 7: Repeat steps 1-4 for PokerGroupPickerAction**

**Step 8: Repeat steps 1-4 for ShowPokerSessionsAction**

**Step 9: Compile to verify changes**

Run:
```bash
docker-compose run --rm build mvn clean compile
```

Expected: Compilation succeeds

**Step 10: Commit**

```bash
git add src/main/java/com/redhat/engineering/plugins/actions/
git commit -m "refactor: migrate User to ApplicationUser in action classes"
```

---

## Task 7: Update Domain Models for User References

**Files:**
- Modify: `src/main/java/com/redhat/engineering/plugins/domain/Session.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/domain/Vote.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/domain/Group.java`

**Step 1: Read Session domain model**

Run:
```bash
cat src/main/java/com/redhat/engineering/plugins/domain/Session.java | grep -A5 -B5 "User"
```

Expected: User field declarations and methods

**Step 2: Update Session model imports**

Replace in `Session.java`:
```java
import com.atlassian.crowd.embedded.api.User;
```

With:
```java
import com.atlassian.jira.user.ApplicationUser;
```

**Step 3: Update Session model fields and methods**

Replace all `User` types with `ApplicationUser` in:
- Field declarations
- Constructor parameters
- Getter/setter methods
- Method parameters

**Step 4: Update serialization if present**

If Session is serialized to JSON/XML, update field references:
- `user.getName()` → `user.getUsername()`

**Step 5: Repeat for Vote model**

Apply same pattern to `Vote.java`

**Step 6: Repeat for Group model**

Apply same pattern to `Group.java`

**Step 7: Compile to verify**

Run:
```bash
docker-compose run --rm build mvn clean compile
```

Expected: Successful compilation

**Step 8: Commit**

```bash
git add src/main/java/com/redhat/engineering/plugins/domain/
git commit -m "refactor: migrate User to ApplicationUser in domain models"
```

---

## Task 8: Update Panel and Condition Classes

**Files:**
- Modify: `src/main/java/com/redhat/engineering/plugins/panels/PlanningPokerPanel.java`
- Modify: `src/main/java/com/redhat/engineering/plugins/conditions/SessionCreatedCondition.java`

**Step 1: Update PlanningPokerPanel imports**

Replace in `PlanningPokerPanel.java`:
```java
import com.atlassian.crowd.embedded.api.User;
```

With:
```java
import com.atlassian.jira.user.ApplicationUser;
```

**Step 2: Update PlanningPokerPanel User usage**

Replace all `User` types with `ApplicationUser` and update method calls:
- `.getName()` → `.getUsername()`
- `.getUser()` → `.getLoggedInUser()`

**Step 3: Update SessionCreatedCondition**

Apply same migration pattern to `SessionCreatedCondition.java`

**Step 4: Compile to verify**

Run:
```bash
docker-compose run --rm build mvn clean compile
```

Expected: Successful compilation

**Step 5: Commit**

```bash
git add src/main/java/com/redhat/engineering/plugins/panels/ src/main/java/com/redhat/engineering/plugins/conditions/
git commit -m "refactor: migrate User to ApplicationUser in panels and conditions"
```

---

## Task 9: Review and Update JavaScript for AMD Modules

**Files:**
- Read: `src/main/resources/js/planning-poker.js`
- Read: `src/main/resources/js/jquery.shorten.js`

**Step 1: Check for JavaScript globals usage**

Run:
```bash
grep -n "AJS\." src/main/resources/js/planning-poker.js || echo "No AJS globals found"
grep -n "jQuery\|$" src/main/resources/js/planning-poker.js | head -10
```

Expected: List of global variable usage

**Step 2: Document JavaScript modernization needs**

Create:
```bash
cat > docs/javascript-analysis.md << 'EOF'
# JavaScript Modernization Analysis

## Current State
- Uses AJS (Atlassian JavaScript) globals
- jQuery usage patterns
- No AMD module structure

## JIRA 9.11.2 Requirements
- AMD modules preferred
- Global variables deprecated but still supported
- Web resources properly declared in atlassian-plugin.xml

## Action Required
- ✓ Web resources already properly declared in atlassian-plugin.xml with AJS dependency
- ✓ Current JavaScript will continue to work in JIRA 9.11.2
- ⚠️ Consider AMD migration in future for long-term maintenance

## Decision
Keep current JavaScript as-is for this upgrade. It remains compatible with JIRA 9.11.2.
EOF
```

**Step 3: Verify web resource dependencies in plugin descriptor**

Run:
```bash
grep -A10 "web-resource" src/main/resources/atlassian-plugin.xml
```

Expected: Verify `<dependency>com.atlassian.auiplugin:ajs</dependency>` is present

**Step 4: Commit**

```bash
git add docs/javascript-analysis.md
git commit -m "docs: analyze JavaScript compatibility with JIRA 9.11.2"
```

---

## Task 10: Verify Velocity Templates Compatibility

**Files:**
- Read: `src/main/resources/views/**/*.vm`

**Step 1: List all Velocity templates**

Run:
```bash
find src/main/resources/views -name "*.vm" -type f
```

Expected: List of 15 Velocity template files

**Step 2: Check for deprecated Velocity syntax**

Run:
```bash
grep -r "\$user.name\b" src/main/resources/views/ || echo "No user.name references"
grep -r "\$velocityCount" src/main/resources/views/ || echo "No velocityCount usage"
```

Expected: Potential deprecated syntax usage

**Step 3: Document template compatibility**

Create:
```bash
cat > docs/velocity-compatibility.md << 'EOF'
# Velocity Template Compatibility

## JIRA 9.11.2 Changes
- Velocity templates remain fully supported
- JSP templates deprecated in JIRA 10.0+
- Soy templates recommended for new development

## Current Templates
All .vm templates in src/main/resources/views/ are compatible.

## Required Changes
If templates reference User objects:
- Replace `$user.name` with `$user.username`
- `$user.displayName` remains unchanged
- `$user.emailAddress` remains unchanged

## Action
Review templates after service layer testing to identify any runtime issues.
EOF
```

**Step 4: Commit**

```bash
git add docs/velocity-compatibility.md
git commit -m "docs: verify Velocity template compatibility"
```

---

## Task 11: Update Plugin Descriptor for JIRA 9 Compatibility

**Files:**
- Modify: `src/main/resources/atlassian-plugin.xml`

**Step 1: Review plugin descriptor**

Run:
```bash
grep "plugins-version" src/main/resources/atlassian-plugin.xml
```

Expected: `plugins-version="2"`

**Step 2: Verify component-import declarations**

Check that all component imports use proper interfaces:
```bash
grep -A1 "component-import" src/main/resources/atlassian-plugin.xml
```

Expected: Standard SAL API imports (ApplicationProperties, TemplateRenderer, etc.)

**Step 3: Check webwork1 plugin key**

Webwork1 is deprecated but still supported in JIRA 9.x. Document status:

```bash
cat > docs/webwork-status.md << 'EOF'
# Webwork1 Status

## Current Usage
Plugin uses webwork1 actions (SessionAction, VoteAction, ConfigAction, etc.)

## JIRA 9.11.2 Compatibility
- Webwork1 is deprecated but still functional in JIRA 9.x
- Expected to be removed in future JIRA versions
- Migration to REST APIs recommended for long-term

## Decision for This Upgrade
Keep webwork1 actions for now. They work in JIRA 9.11.2.
Plan REST API migration in future release.
EOF
```

**Step 4: Update plugin version in POM**

In `pom.xml`, update version:
```xml
<version>1.2</version>
```

To:
```xml
<version>2.0.0-SNAPSHOT</version>
```

This indicates major upgrade for JIRA 9.11.2 compatibility.

**Step 5: Commit**

```bash
git add docs/webwork-status.md pom.xml
git commit -m "docs: document webwork1 status and bump version to 2.0.0-SNAPSHOT"
```

---

## Task 12: Build Plugin in Docker Environment

**Files:**
- Build: `target/planning-poker-2.0.0-SNAPSHOT.jar`

**Step 1: Clean build**

Run:
```bash
docker-compose run --rm build mvn clean
```

Expected: Target directory cleaned

**Step 2: Compile sources**

Run:
```bash
docker-compose run --rm build mvn compile
```

Expected: Successful compilation with no errors
If errors occur, document them and fix before proceeding.

**Step 3: Run tests**

Run:
```bash
docker-compose run --rm build mvn test
```

Expected: Tests pass or skip (if no tests configured)

**Step 4: Package plugin**

Run:
```bash
docker-compose run --rm build mvn package
```

Expected: `target/planning-poker-2.0.0-SNAPSHOT.jar` created successfully

**Step 5: Verify JAR contents**

Run:
```bash
docker-compose run --rm build jar tf target/planning-poker-2.0.0-SNAPSHOT.jar | head -20
```

Expected: JAR contains compiled classes and resources

**Step 6: Document build success**

```bash
echo "✓ Plugin successfully built for JIRA 9.11.2" >> docs/build-log.md
echo "Build date: $(date)" >> docs/build-log.md
echo "Artifact: target/planning-poker-2.0.0-SNAPSHOT.jar" >> docs/build-log.md
```

**Step 7: Commit**

```bash
git add docs/build-log.md
git commit -m "build: verify successful plugin build for JIRA 9.11.2"
```

---

## Task 13: Test Plugin Installation in JIRA 9.11.2

**Files:**
- Test: Plugin installation and activation

**Step 1: Start JIRA 9.11.2 in Docker**

Run:
```bash
docker-compose up -d jira
```

Expected: JIRA container starts

**Step 2: Wait for JIRA to be ready**

Run:
```bash
echo "Waiting for JIRA to start..."
until docker-compose exec jira curl -sf http://localhost:8080/status >/dev/null 2>&1; do
    echo -n "."
    sleep 10
done
echo "JIRA is ready"
```

Expected: JIRA responds to health check

**Step 3: Access JIRA setup**

Open browser or use curl:
```bash
echo "JIRA accessible at: http://localhost:2990"
echo "Complete initial setup wizard if needed"
```

**Step 4: Use Atlassian SDK to install plugin**

Alternative approach using SDK:
```bash
docker-compose run --rm build atlas-run-standalone --product jira --version 9.11.2 --plugins target/planning-poker-2.0.0-SNAPSHOT.jar
```

Expected: JIRA starts with plugin loaded

**Step 5: Verify plugin in UPM**

Manual step:
1. Navigate to http://localhost:2990/plugins/servlet/upm
2. Search for "Planning Poker"
3. Verify plugin is listed and enabled

**Step 6: Document test results**

```bash
cat > docs/integration-test-results.md << 'EOF'
# Integration Test Results - JIRA 9.11.2

## Test Date
[Date]

## Environment
- JIRA Version: 9.11.2
- Plugin Version: 2.0.0-SNAPSHOT
- Java Version: 17

## Installation Test
- [ ] Plugin appears in UPM
- [ ] Plugin enables without errors
- [ ] No errors in atlassian-jira.log

## Functional Tests
- [ ] Create Poker Session menu item appears
- [ ] Poker Sessions link appears in navigation
- [ ] Can create new poker session
- [ ] Can vote on session
- [ ] Planning Poker panel appears on issue view
- [ ] Configuration page accessible

## Issues Found
[Document any issues]

## Status
[PASS/FAIL]
EOF
```

**Step 7: Commit**

```bash
git add docs/integration-test-results.md
git commit -m "test: document JIRA 9.11.2 integration test results"
```

---

## Task 14: Run Manual Functional Tests

**Files:**
- Test: Core plugin functionality

**Step 1: Create test issue**

Manual steps:
1. Log into JIRA at http://localhost:2990
2. Create a test project if not exists
3. Create a test issue

**Step 2: Test session creation**

1. Open test issue
2. Click "More" → "Create Poker Session"
3. Fill in start date, end date, select users
4. Click "Create Session"
5. Verify session appears in Planning Poker panel

**Step 3: Test voting**

1. Click "Select Action" → "Vote"
2. Select a card (e.g., 5)
3. Click "Vote"
4. Verify vote recorded

**Step 4: Test view voters**

1. Click on the number in "Votes" row
2. Verify list of voters appears

**Step 5: Test view results (after session ends)**

1. Wait for session end time or manually update session end time
2. Click "Select Action" → "View Votes"
3. Verify all votes displayed

**Step 6: Test configuration**

1. Go to Settings (cogwheel) → System → Planning Poker
2. Verify configuration page loads
3. Test saving configuration

**Step 7: Test sessions list**

1. Click "Poker Sessions" in top navigation
2. Verify list of all sessions displays

**Step 8: Document functional test results**

Update `docs/integration-test-results.md` with test outcomes:
```markdown
## Functional Tests - Completed
- [X] Create Poker Session menu item appears - PASS
- [X] Poker Sessions link appears in navigation - PASS
- [X] Can create new poker session - PASS/FAIL
- [X] Can vote on session - PASS/FAIL
- [X] Planning Poker panel appears on issue view - PASS/FAIL
- [X] Configuration page accessible - PASS/FAIL

## Issues Found
[List any bugs or issues]
```

**Step 9: Commit**

```bash
git add docs/integration-test-results.md
git commit -m "test: complete manual functional testing on JIRA 9.11.2"
```

---

## Task 15: Fix Any Compatibility Issues Found

**Files:**
- Fix: Any files with runtime errors

**Step 1: Review JIRA logs for errors**

Run:
```bash
docker-compose exec jira cat /var/atlassian/application-data/jira/log/atlassian-jira.log | tail -100
```

Expected: Check for plugin-related errors

**Step 2: Identify compatibility issues**

Common issues to check:
- NullPointerException from User → ApplicationUser migration
- ClassNotFoundException for moved APIs
- MethodNotFoundException for renamed methods
- Template rendering errors

**Step 3: Fix identified issues**

Based on error logs, update affected files.

Example fix patterns:

**Issue: NullPointerException on user.getUsername()**
```java
// Before
String username = user.getUsername();

// After - null check
String username = user != null ? user.getUsername() : "anonymous";
```

**Issue: Template variable access error**
Update Velocity template:
```velocity
## Before
$user.name

## After
$user.username
```

**Step 4: Rebuild plugin**

Run:
```bash
docker-compose run --rm build mvn clean package
```

Expected: Clean build

**Step 5: Reinstall plugin**

1. Uninstall old version from UPM
2. Upload new JAR from target/
3. Enable plugin

**Step 6: Retest affected functionality**

Repeat functional tests for areas that had errors.

**Step 7: Document fixes**

```bash
cat > docs/compatibility-fixes.md << 'EOF'
# Compatibility Fixes Applied

## Issue 1: [Description]
**Error:** [Error message]
**File:** [File path]
**Fix:** [Description of fix]

## Issue 2: [Description]
[...]

## Verification
All issues resolved and functionality verified.
EOF
```

**Step 8: Commit**

```bash
git add src/ docs/compatibility-fixes.md
git commit -m "fix: resolve JIRA 9.11.2 compatibility issues"
```

---

## Task 16: Update Documentation for JIRA 9.11.2

**Files:**
- Modify: `README.md`
- Create: `docs/upgrade-guide.md`

**Step 1: Update README with version requirements**

Add section after title in `README.md`:

```markdown
## Version Compatibility

**Current Version:** 2.0.0
**JIRA Compatibility:** JIRA 9.11.2 and later
**Java Version:** Java 17
**Previous Versions:** For JIRA 6.4 - 8.x, use version 1.2

## Requirements

- JIRA Software/Core 9.11.2+
- Java 17 runtime environment
```

**Step 2: Create upgrade guide**

```markdown
# Upgrade Guide: Planning Poker Plugin 1.2 → 2.0

## Overview

Version 2.0 is a major upgrade that brings compatibility with JIRA 9.11.2 and modern Java environments.

## Breaking Changes

### JIRA Version Requirements
- **Minimum JIRA Version:** 9.11.2
- **No longer supports:** JIRA 6.4 - 9.10.x

### Java Requirements
- **Required:** Java 17
- **No longer supports:** Java 8 and earlier

## Migration from 1.2 to 2.0

### Prerequisites
1. JIRA upgraded to 9.11.2 or later
2. Java 17 installed

### Upgrade Steps

1. **Backup existing data**
   - Planning Poker session data is stored in JIRA plugin settings
   - Backup JIRA database before upgrade

2. **Uninstall version 1.2**
   - Go to UPM (Universal Plugin Manager)
   - Uninstall Planning Poker 1.2

3. **Install version 2.0**
   - Upload planning-poker-2.0.0.jar via UPM
   - Enable the plugin

4. **Verify functionality**
   - Check existing poker sessions still accessible
   - Create test session to verify voting works

### Data Compatibility

All existing planning poker sessions, votes, and groups are preserved. The plugin upgrade is backward compatible with data from version 1.2.

## Known Issues

None at this time.

## Rollback

If you need to rollback:
1. Uninstall version 2.0
2. Reinstall version 1.2 (requires JIRA downgrade to 6.4 - 8.x)

## Support

Report issues at: https://github.com/VaclavDedik/planning-poker-plugin/issues
```

**Step 3: Update build instructions**

Add to README.md:

```markdown
## Building from Source

### Requirements
- Java 17 JDK
- Maven 3.9+
- Atlassian Plugin SDK 9.0.2+

### Docker Build (Recommended)

```bash
# Build using Docker
docker-compose run --rm build mvn clean package

# Output: target/planning-poker-2.0.0.jar
```

### Local Build

```bash
# Install Atlassian SDK first
# Then run:
atlas-mvn clean package
```

### Testing

```bash
# Run with JIRA 9.11.2
atlas-run --product jira --version 9.11.2
```
```

**Step 4: Commit**

```bash
git add README.md docs/upgrade-guide.md
git commit -m "docs: update documentation for JIRA 9.11.2 compatibility"
```

---

## Task 17: Create Release Package

**Files:**
- Create: `target/planning-poker-2.0.0.jar` (final release)

**Step 1: Update version to release version**

In `pom.xml`, change:
```xml
<version>2.0.0-SNAPSHOT</version>
```

To:
```xml
<version>2.0.0</version>
```

**Step 2: Final clean build**

Run:
```bash
docker-compose run --rm build mvn clean package
```

Expected: `target/planning-poker-2.0.0.jar` created

**Step 3: Generate checksums**

Run:
```bash
docker-compose run --rm build sh -c "cd target && sha256sum planning-poker-2.0.0.jar > planning-poker-2.0.0.jar.sha256"
```

**Step 4: Create release notes**

```bash
cat > docs/RELEASE-NOTES-2.0.0.md << 'EOF'
# Planning Poker Plugin 2.0.0 Release Notes

**Release Date:** [Date]

## Major Changes

### JIRA 9.11.2 Compatibility
- Upgraded plugin to support JIRA 9.11.2
- Migrated from deprecated User API to ApplicationUser API
- Updated Java 6 to Java 17
- Upgraded AMPS from 5.0.13 to 9.0.2

### Technical Improvements
- Updated all dependencies to modern versions
- Improved security with latest dependency versions
- Enhanced compatibility with modern Java environments

## Breaking Changes

- **Minimum JIRA version:** 9.11.2 (no longer supports JIRA 6.4 - 9.10.x)
- **Minimum Java version:** Java 17 (no longer supports Java 8 and earlier)

## Bug Fixes

[List any bugs fixed during migration]

## Known Issues

None at this time.

## Upgrade Instructions

See [Upgrade Guide](upgrade-guide.md) for detailed migration steps.

## Download

- Binary: `planning-poker-2.0.0.jar`
- SHA256: [checksum value]

## Credits

Original plugin by Vaclav Dedik
JIRA 9.11.2 upgrade by [Your Name/Team]
EOF
```

**Step 5: Verify JAR integrity**

Run:
```bash
docker-compose run --rm build jar tf target/planning-poker-2.0.0.jar | wc -l
```

Expected: Reasonable number of files in JAR (>50)

**Step 6: Commit release version**

```bash
git add pom.xml docs/RELEASE-NOTES-2.0.0.md
git commit -m "release: prepare Planning Poker Plugin 2.0.0 for JIRA 9.11.2"
```

**Step 7: Tag release**

```bash
git tag -a v2.0.0 -m "Planning Poker Plugin 2.0.0 - JIRA 9.11.2 Compatible"
```

---

## Task 18: Final Verification and Cleanup

**Files:**
- Verify: All changes committed
- Clean: Docker resources

**Step 1: Verify all changes committed**

Run:
```bash
git status
```

Expected: Working tree clean

**Step 2: Review commit history**

Run:
```bash
git log --oneline -20
```

Expected: Clean commit history with descriptive messages

**Step 3: Stop Docker containers**

Run:
```bash
docker-compose down
```

**Step 4: Clean Docker volumes (optional)**

If you want to clean test data:
```bash
docker-compose down -v
```

**Step 5: Create final verification checklist**

```bash
cat > docs/verification-checklist.md << 'EOF'
# Final Verification Checklist

## Code Changes
- [x] User → ApplicationUser migration complete
- [x] All imports updated
- [x] All method calls updated
- [x] Domain models updated

## Build System
- [x] POM updated to JIRA 9.11.2
- [x] AMPS updated to 9.0.2
- [x] Java version updated to 17
- [x] Dependencies updated

## Testing
- [x] Plugin builds successfully
- [x] Plugin installs in JIRA 9.11.2
- [x] All core functionality tested
- [x] No errors in JIRA logs

## Documentation
- [x] README updated
- [x] Upgrade guide created
- [x] Release notes created
- [x] Build instructions updated

## Release
- [x] Version bumped to 2.0.0
- [x] JAR created
- [x] Checksums generated
- [x] Git tag created

## Status
✅ Ready for release
EOF
```

**Step 6: Create summary report**

```bash
cat > docs/upgrade-summary.md << 'EOF'
# JIRA 9.11.2 Upgrade Summary

## Objective
Upgrade Planning Poker Plugin from JIRA 6.4 to JIRA 9.11.2 compatibility.

## Scope
- API migration (User → ApplicationUser)
- Dependency updates
- Build system modernization
- Java 6 → Java 17 upgrade
- Testing and verification

## Results
✅ **SUCCESS** - Plugin fully compatible with JIRA 9.11.2

## Key Metrics
- Files modified: [count from git]
- Lines changed: [from git diff --stat]
- Build time: [time]
- Test results: PASS

## Deliverables
1. planning-poker-2.0.0.jar
2. SHA256 checksum
3. Complete documentation
4. Upgrade guide
5. Release notes

## Next Steps
1. Deploy to test environment
2. User acceptance testing
3. Release to production
4. Monitor for issues

## Lessons Learned
[Document any insights from the upgrade process]
EOF
```

**Step 7: Final commit**

```bash
git add docs/verification-checklist.md docs/upgrade-summary.md
git commit -m "docs: final verification and upgrade summary"
```

---

## Completion

After completing all 18 tasks:

1. **Plugin Status:** ✅ Compatible with JIRA 9.11.2
2. **Build Artifact:** `target/planning-poker-2.0.0.jar`
3. **Documentation:** Complete upgrade guide and release notes
4. **Git History:** Clean, well-documented commits
5. **Docker Environment:** Reusable build and test setup

**Next Actions:**
- Deploy to staging environment
- Conduct user acceptance testing
- Prepare for production release
- Announce upgrade availability to users

**Required Sub-Skill:** Use @superpowers:finishing-a-development-branch after all tasks complete.
